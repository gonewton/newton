#!/bin/bash

# Pre-commit Hook for Rust Project
# Run basic quality checks before committing

set -e

echo "ğŸ” Running pre-commit checks..."
echo "==============================="

# Check if we're in the right directory
if [ ! -f "Cargo.toml" ]; then
    echo "âŒ Error: Run this script from the project root"
    exit 1
fi

echo "âœ… Repository structure verified"

# Check code formatting
echo ""
echo "ğŸ“ Checking code formatting..."
if cargo fmt --check; then
    echo "âœ… Code formatting is correct"
else
    echo "âŒ Code formatting issues found. Run 'cargo fmt' to fix."
    exit 1
fi

# Run clippy linting
echo ""
echo "ğŸ”§ Running clippy linting..."
if cargo clippy --all-targets --all-features -- -D warnings; then
    echo "âœ… Clippy checks passed"
else
    echo "âŒ Clippy found issues. Fix the warnings before committing."
    exit 1
fi

# Run quick unit tests
echo ""
echo "ğŸ§ª Running unit tests..."
if cargo test --lib --quiet; then
    echo "âœ… Unit tests passed"
else
    echo "âŒ Unit tests failed. Fix the issues before committing."
    exit 1
fi

echo ""
echo "ğŸ‰ All pre-commit checks passed!"
echo ""

exit 0
