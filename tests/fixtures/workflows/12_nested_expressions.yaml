version: "2.0"
mode: "workflow_graph"
metadata:
  name: "Scenario 12: Nested Expressions"
workflow:
  context:
    base: 10
    multiplier: 5
    offset: 2
  settings:
    entry_task: "calculate"
    max_time_seconds: 60
    parallel_limit: 1
    continue_on_error: false
    max_task_iterations: 10
    max_workflow_iterations: 100
  tasks:
    - id: "calculate"
      operator: "SetContextOperator"
      params:
        patch:
          result: { $expr: "(context.base * context.multiplier) + context.offset" }
      transitions:
        - to: "check_result"
    - id: "check_result"
      operator: "NoOpOperator"
      transitions:
        - to: "success"
          when: { $expr: "tasks.calculate.output.patch.result == 52" }
        - to: "fail"
          when: { $expr: "tasks.calculate.output.patch.result != 52" }
    - id: "success"
      operator: "NoOpOperator"
      terminal: success
    - id: "fail"
      operator: "NoOpOperator"
      terminal: failure
